
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>WebShell Analyzer - IOC Report</title>
    <style>
        mark { background-color: #ff4d4d; color: white; font-weight: bold; }
        mark.encoded { background-color: orange; color: black; }
        mark.c2 { background-color: purple; color: white; }
        mark.custom { background-color: orange; color: black; font-weight: bold; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f4f6f9; margin: 0; padding: 20px; }
        h1, h2 { color: #2c3e50; text-align: center; }
        table { width: 100%; border-collapse: collapse; margin-top: 25px; }
        th, td { padding: 12px 15px; border: 1px solid #ddd; text-align: left; }
        th { background-color: #34495e; color: white; }
        tr:nth-child(even) { background-color: #ecf0f1; }
        .flags { color: #c0392b; font-weight: bold; }
        mark { background-color: yellow; color: black; font-weight: bold; }
        .footer { text-align: center; margin-top: 40px; font-size: 0.9em; color: #888; }
		.filter-container {
            text-align: center;
            margin: 10px 0 30px 0;
        }
        .filter-container input {
            width: 70%;
            padding: 10px;
            font-size: 14px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
    </style>
</head>

<body>
    <h1>WebShell Analyzer - IOC Report</h1>
    <h2>IIS</h2>
	
	 <div class="filter-container">
        <input type="text" id="filterInput" placeholder="Filter by anything...">
    </div>
    <table>
	 <thead>
        <tr>
            <th>Timestamp</th>
            <th>Username</th>
            <th>IP Address</th>
            <th>URI</th>
            <th>Query</th>
            <th>HTTP Method</th>
            <th style="min-width: 500px;">User-Agent</th>
            <th>Referer</th>
            <th>Log File</th>
            <th style="min-width: 175px;">IOC Flags</th>
        </tr>
	 </thead>
	 <tbody>
			{% for rec in records %}
			<tr>
				<td>{{ rec.timestamp }}</td>
				<td>{{ rec.username }}</td>
				<td>
				  <a href="https://ekky19.github.io/osint/?ip={{ rec.src_ip | replace('<mark class=\"c2\">', '') | replace('</mark>', '') }}" target="_blank">
					{{ rec.src_ip }}
				  </a>
				</td>
				<td>{{ rec.uri|safe }}</td>
				<td>{{ rec.query|safe }}</td>
				<td>{{ rec.http_method }}</td>
				<td style="word-break: break-word;">{{ rec.user_agent }}</td>
				<td>{{ rec.referer }}</td>
				<td>{{ rec.log_file }}</td>
				<td class="flags">{{ ", ".join(rec.flags) }}</td>
			</tr>
			{% endfor %}
			<tr class="no-match-row" style="display: none;">
				<td colspan="10" style="text-align: center; font-style: italic; color: #888;">
					No matching records found.
				</td>
			</tr>
		</tbody>
    </table>

    <h2>MFT Correlation Hits</h2>
    <table>
		<thead>
			<tr>
				<th>Matched File</th>
				<th>Entry #</th>
				<th>Created (0x10)</th>
				<th>Flags</th>
				<th>Username</th>
				<th>IP Address</th>
				<th>Log Source</th>
				<th>Correlation Type</th>
			</tr>
		</thead>
		<tbody>
			{% for hit in mft_hits %}
			<tr>
				<td>{{ hit.matched_file }}</td>
				<td>{{ hit.entry_number }}</td>
				<td>{{ hit.created_0x10 }}</td>
				<td class="flags">{{ hit.flags }}</td>
				<td>{{ hit.username }}</td>
				<td>{{ hit.src_ip }}</td>
				<td>{{ hit.log_source }}</td>
				<td>{{ hit.correlation }}</td>
			</tr>
			{% endfor %}
			<tr class="no-match-row" style="display: none;">
            <td colspan="8" style="text-align:center; font-style: italic; color: #888;">
                No matching records found.
            </td>
        </tr>
		</tbody>
    </table>

    <div class="footer" style="background-color: #2c3e50; color: #ecf0f1; padding: 12px; border-top: 1px solid #34495e;">
        Report generated by WebShell Analyzer<br>
        Developed by
        <a href="https://www.linkedin.com/in/ekremozdemir19/"
           target="_blank"
           title="https://www.linkedin.com/in/ekremozdemir19/"
           style="color: #ecf0f1; font-weight: 600; text-decoration: none;">
            Ekrem O.
        </a>
    </div>
	<script>
		document.addEventListener('DOMContentLoaded', () => {
			const filterInput = document.getElementById('filterInput');
			const contextMenu = document.getElementById('customContextMenu');
			const filterItem = document.getElementById('filterBySelection');

			// FILTER LOGIC (applies to each <tbody> separately)
			function applyFilter(value) {
				filterInput.value = value.toLowerCase();
				const tbodies = document.querySelectorAll('table tbody');

				tbodies.forEach(tbody => {
					const rows = tbody.querySelectorAll('tr:not(.no-match-row)');
					let anyVisible = false;

					rows.forEach(row => {
						const rowText = row.innerText.toLowerCase();
						const match = rowText.includes(value.toLowerCase());
						row.style.display = match ? '' : 'none';
						if (match) anyVisible = true;
					});

					const noMatchRow = tbody.querySelector('.no-match-row');
					if (noMatchRow) noMatchRow.style.display = anyVisible ? 'none' : '';
				});
			}

			// On keyup
			filterInput.addEventListener('keyup', function () {
				applyFilter(this.value);
			});

			// Double-click to reset all
			filterInput.addEventListener('dblclick', function () {
				this.value = '';
				const tbodies = document.querySelectorAll('table tbody');
				tbodies.forEach(tbody => {
					tbody.querySelectorAll('tr').forEach(row => row.style.display = '');
					const noMatchRow = tbody.querySelector('.no-match-row');
					if (noMatchRow) noMatchRow.style.display = 'none';
				});
			});

			// Right-click context menu to filter
			document.addEventListener('contextmenu', function (e) {
				const selection = window.getSelection().toString().trim();
				if (selection) {
					e.preventDefault();
					contextMenu.style.top = `${e.pageY}px`;
					contextMenu.style.left = `${e.pageX}px`;
					contextMenu.style.display = 'block';

					filterItem.onclick = function () {
						applyFilter(selection);
						contextMenu.style.display = 'none';
					};
				} else {
					contextMenu.style.display = 'none';
				}
			});

			// Hide menu on click anywhere else
			document.addEventListener('click', function () {
				contextMenu.style.display = 'none';
			});
		});
	</script>
	
	<ul id="customContextMenu" style="
    display: none;
    position: absolute;
    z-index: 1000;
    list-style: none;
    margin: 0;
    padding: 8px 0;
    background: white;
    border: 1px solid #ccc;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    font-size: 14px;
    width: 160px;
">
    <li id="filterBySelection" style="padding: 8px 12px; cursor: pointer;">üîç Filter by selection</li>
</ul>


</body>
</html>
